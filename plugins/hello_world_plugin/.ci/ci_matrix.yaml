---
job: ufm-hello-world-plugin

registry_host: harbor.mellanox.com
registry_path: /swx-storage/ci-demo
registry_auth: swx-storage
step_allow_single_selector: true

env:
  plugin_name: "hello_world_plugin"

kubernetes:
  cloud: swx-k8s-spray

volumes:
  - {mountPath: /var/run/docker.sock, hostPath: /var/run/docker.sock}

runs_on_dockers:
   - {file: 'plugins/hello_world_plugin/.ci/Dockerfile', arch: 'x86_64', name: '$plugin_name', tag: 'latest'}


steps:
  - name: build Plugin
    containerSelector: "{name:'$plugin_name'}"
    run: |
      cd plugins/$plugin_name/build
      bash -x ./docker_build.sh latest /
      cp /$plugin_name* /auto/UFM/tmp/${JOB_NAME}/${BUILD_ID}/
    parallel: false
    

pipeline_start:
  run: |
    mkdir -p /auto/UFM/tmp/${JOB_NAME}/${BUILD_ID}


pipeline_stop:
  run: |
    sudo rm -rf /auto/UFM/tmp/${JOB_NAME}/${BUILD_ID}
  








# Fail job if one of the steps fails or continue
failFast: false
batchSize: 1